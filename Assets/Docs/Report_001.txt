Sporae ‚Äî Blocking_01 ‚Äî Fase 0 (Setup Tecnico)
Panoramica
La Fase 0 del Blocking_01 ha avuto come obiettivo il setup tecnico iniziale del progetto Sporae, la definizione delle cartelle, delle scene fondamentali e l‚Äôimplementazione dei primi sistemi base (movimento, gestione risorse, HUD, ascensore). Tutte le attivit√† pianificate sono state completate con successo.
________________________________________
Task completati
BLK-00.01 ‚Äî Creazione progetto Unity 2D URP LTS
‚Ä¢	Creato nuovo progetto Unity con template 2D URP LTS.
‚Ä¢	Nome: Sporium_Blocking_01.
‚Ä¢	Verificata configurazione pipeline grafica e versioning LTS.
BLK-00.02 ‚Äî Struttura cartelle + Repo Git
‚Ä¢	Organizzate cartelle in Assets/: Scenes, Prefabs, Scripts, Placeholders, UI.
‚Ä¢	Creato repository Git con .gitignore specifico per Unity.
BLK-00.03 ‚Äî Scene placeholder
‚Ä¢	Generate scene iniziali vuote (Dome, Lab, Visitor Room, Seed Storage, Bedroom).
‚Ä¢	Successivamente convertite in prefab modulari (Rooms) alla luce della decisione Vault unica.
‚Ä¢	Aggiunta scena SCN_Bootstrap con APP_Root e Canvas_Loading.
BLK-00.04 ‚Äî Player click-to-move
‚Ä¢	Implementato sistema di movimento punta-e-clicca:
o	PlayerClickMover2D: Raycast verso NAV_Plane con Ground Mask.
o	Player con Rigidbody2D Kinematic e Collider2D.
‚Ä¢	Aggiunto supporto W/S (fallback scale manuali).
BLK-00.05 ‚Äî GameManager + HUD + EndDay
‚Ä¢	Creato GameManager (singleton + DontDestroyOnLoad).
o	Variabili: Giorni, Azioni, CRY, Inventario.
o	Eventi OnDayChanged, OnActionsChanged, OnCRYChanged.
‚Ä¢	Creato HUD con TextMeshPro:
o	TXT_Day, TXT_Actions, TXT_CRY.
o	Controller: HUDController.
‚Ä¢	Pulsante BTN_EndDay per avanzare il giorno e scalare risorse.
‚Ä¢	Pulsante BTN_DummyAction con ActionCost e DummyAction per test consumo Azioni e CRY.
BLK-00.06 ‚Äî Implementare Ascensore
‚Ä¢	Decisione ufficiale: Vault unica scena verticale in stile Fallout Shelter.
‚Ä¢	Creata scena SCN_VaultMap con struttura base:
o	ELEV_Elevator (Empty root).
o	ELEV_Levels con target Y (LVL_-1, LVL_0, LVL_+1).
o	ELEV_UseZone con BoxCollider2D (IsTrigger).
o	UI_ElevatorPanel con bottoni BTN_LVL_-1, BTN_LVL_0, BTN_LVL_+1.
‚Ä¢	Script ElevatorSystem:
o	Mostra/nasconde pannello UI.
o	Funzione GoToLevel(int) che sposta il Player e scala ‚Äì5 CRY.
o	Se CRY insufficiente ‚Üí log warning + fallback scale manuali con W/S.
‚Ä¢	Debug log in Console per confermare interazioni.
________________________________________
Decisioni strutturali prese durante la Fase 0
‚Ä¢	Vault come unica scena: tutte le stanze modulari (Visitor, Dome, Lab, Food, Bedroom) sono prefab piazzati in SCN_VaultMap. Nessun caricamento scena per i piani, navigazione solo verticale.
‚Ä¢	SCN_Bootstrap rimane scena di avvio, carica SCN_VaultMap.
‚Ä¢	SYS_GameManager rimane globale con DontDestroyOnLoad.
‚Ä¢	Le stanze prefab contengono solo ambienti e trigger locali, non logiche globali.
‚Ä¢	HUD unico e persistente.
________________________________________
Stato finale Fase 0 (27/08/2025)
Tutti i task BLK-00.01 ‚Üí BLK-00.06 sono DONE e funzionanti: - Progetto avviabile da SCN_Bootstrap ‚Üí SCN_VaultMap. - Player si muove con click-to-move. - GameManager traccia Giorni/Azioni/CRY. - HUD aggiornato in tempo reale. - Pulsanti EndDay e DummyAction funzionano. - Ascensore operativo (CRY cost, fallback scale).
La Fase 0 pu√≤ considerarsi completata con successo ‚úÖ.

INIZIO FASE 1

üéØ IMPLEMENTAZIONE COMPLETATA - BLK-01.01
File Creati:
PotSlot.cs - Script principale per i vasi interattivi
Gestione click, evidenziazione, stati
Controllo distanza dal Player
Eventi per selezione vaso
Gizmos per visibilit√† in Editor
PotHUDWidget.cs - Widget UI integrato con HUD esistente
Mostra info sui vasi selezionati
Integrazione automatica con Canvas
Fallback se non trova HUD esistente
Posizionamento configurabile
RoomDomePotsBootstrap.cs - Bootstrap automatico per la Dome
Crea 2 vasi (POT-001, POT-002) automaticamente
Posizioni configurabili via Inspector
Supporto per prefab opzionale
Gizmos per visibilit√†
PotSystemConfig.cs - Configurazione globale del sistema
Costanti e impostazioni condivise
Validazione parametri
Colori e stati predefiniti
PotSystemTester.cs - Script di test completo
Test automatici con tasti T/R
Verifica integrazione con sistemi esistenti
Debug e troubleshooting
PotSystemIntegration.cs - Esempio per BLK-01.02+
Integrazione con GameManager esistente
Sistema costi CRY e azioni
Logica per piantare/annaffiare/illuminare
PREF_POT_Slot.prefab - Prefab del vaso (opzionale)
Componenti preconfigurati
Fallback a creazione runtime
README_BLK-01.01.md - Documentazione completa
Setup passo-passo
Test di accettazione
Configurazione avanzata
‚úÖ Funzionalit√† Implementate:
2 vasi interattivi nella Dome con ID univoci
Click handling con controllo distanza dal Player
Evidenziazione al passaggio del mouse
Widget HUD integrato con sistema esistente
Bootstrap automatico per creazione vasi
Sistema di test completo per debugging
Configurazione globale centralizzata
Integrazione futura con GameManager (BLK-01.02+)


--------------------------------------------------------

#    **REPORT BLK-01.02 ‚Äî "Azioni base sul vaso (pianta/annaffia/illumina)"**

## üéØ **Obiettivo del Task**
Implementare il sistema base di interazione con i vasi nella Dome, permettendo al Player di eseguire tre azioni fondamentali: **Piantare**, **Annaffiare**, **Illuminare**.

## ‚úÖ **Componenti Implementati**

### **1. Core System Components**
- **`PotActions.cs`** - Logica centrale per le azioni sui vasi
  - Metodi di validazione: `CanPlant()`, `CanWater()`, `CanLight()`
  - Metodi di esecuzione: `DoPlant()`, `DoWater()`, `DoLight()`
  - Gestione risorse (azioni, CRY, inventory)
  - Aggiornamento stato del vaso

- **`PotStateModel.cs`** - Modello dati per lo stato del vaso
  - Propriet√†: `PotId`, `HasPlant`, `Stage`, `Hydration`, `LightExposure`
  - Metodi di manipolazione stato
  - Tracking temporale (giorni di piantagione, annaffiatura, illuminazione)

- **`PotEvents.cs`** - Sistema eventi centralizzato
  - Eventi: `OnPotAction`, `OnPotStateChanged`, `OnPotSelected`, `OnPotActionFailed`
  - Enum: `PotActionType` (Plant, Water, Light)

### **2. Configuration & Integration**
- **`PotSystemConfig.cs`** - ScriptableObject per configurazione centralizzata
  - Costi: `CostActionsPerPotAction`, `CostCryPerPotAction`
  - Distanze: `InteractDistance`
  - Limiti: `MaxHydration`, `MaxLightExposure`
  - Codici: `GenericSeedCode`, `PotLayerMask`

- **`PotSystemIntegration.cs`** - Bridge tra UI, selezione e azioni
  - Coordinamento aggiornamenti UI
  - Gestione eventi di selezione
  - Calcolo costi totali per azioni disponibili

### **3. UI System**
- **`PotHUDWidget.cs`** - Widget dinamico per azioni
  - Creazione dinamica pulsanti azione
  - Posizionamento Y=60 per evitare sovrapposizioni
  - EventTrigger per robusta gestione click
  - Transizioni e navigazione configurate

### **4. Bootstrap & Setup**
- **`RoomDomePotsBootstrap.cs`** - Istanziazione vasi con PotActions
- **`PotSystemAutoSetup.cs`** - Setup automatico componenti sistema
- **`PotSystemDebugger.cs`** - Debug in-editor (F1-F3)
- **`PotActionsFixer.cs`** - Aggiunta retroattiva PotActions

### **5. UI Click-Through Prevention**
- **`UIBlocker.cs`** - Utility per rilevare click su UI
  - Metodo `IsPointerOverUI()` per bloccare input
  - Integrato in `PlayerClickMover2D` e `PotSlot`
  - Previene movimento Player quando si clicca sui pulsanti HUD

## üîß **Modifiche ai Sistemi Esistenti**

### **GameManager.cs**
- **Azioni per giorno**: da 3 a 4
- **Inventory iniziale**: `SDE-001` x3 (semi generici)
- **Eventi**: `OnDayChanged`, `OnActionsChanged`, `OnCRYChanged`

### **PotSlot.cs**
- **Gestione input**: `OnMouseDown` + `HandlePotClick()`
- **Protezione UI**: `UIBlocker.IsPointerOverUI()` check
- **Distanza interazione**: sincronizzata con `PotSystemConfig` (2.0f)
- **Sistema selezione**: singolo vaso selezionabile con evidenziazione

### **PlayerClickMover2D.cs**
- **Blocco movimento**: early-return se click su UI
- **Integrazione**: `UIBlocker.IsPointerOverUI()` check

## üéÆ **Meccaniche di Gameplay Implementate**

### **Resource Gating**
- **Azioni**: 1 azione per ogni interazione vaso
- **CRY**: costo configurabile per azione
- **Inventory**: richiede item specifici (es. semi per piantare)
- **Distanza**: Player deve essere entro `InteractDistance`

### **State Management**
- **Vasi vuoti**: possono essere piantati
- **Vasi occupati**: possono essere annaffiati/illuminati
- **Tracking**: giorni di piantagione, annaffiatura, illuminazione
- **Limiti**: idratazione e esposizione massime configurabili

### **UI Integration**
- **Pulsanti dinamici**: mostrati solo per azioni disponibili
- **Costi visualizzati**: azioni e CRY richiesti
- **Feedback visivo**: stato del vaso e azioni eseguite
- **Click robusti**: EventTrigger previene click-through

## üìÅ **File Structure Implementata**
```
Assets/_Project/Scripts/
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ GameManager.cs (modificato)
‚îÇ   ‚îî‚îÄ‚îÄ UIBlocker.cs (nuovo)
‚îú‚îÄ‚îÄ Dome/
‚îÇ   ‚îú‚îÄ‚îÄ PotSystem/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PotActions.cs (nuovo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PotStateModel.cs (nuovo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PotEvents.cs (nuovo)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PotSystemConfig.cs (nuovo)
‚îÇ   ‚îú‚îÄ‚îÄ PotSystemIntegration.cs (nuovo)
‚îÇ   ‚îú‚îÄ‚îÄ RoomDomePotsBootstrap.cs (modificato)
‚îÇ   ‚îú‚îÄ‚îÄ PotSystemAutoSetup.cs (nuovo)
‚îÇ   ‚îú‚îÄ‚îÄ PotSystemDebugger.cs (nuovo)
‚îÇ   ‚îî‚îÄ‚îÄ PotActionsFixer.cs (nuovo)
‚îú‚îÄ‚îÄ Interactables/
‚îÇ   ‚îî‚îÄ‚îÄ PotSlot.cs (modificato)
‚îú‚îÄ‚îÄ Player/
‚îÇ   ‚îî‚îÄ‚îÄ PlayerClickMover2D.cs (modificato)
‚îî‚îÄ‚îÄ UI/
    ‚îî‚îÄ‚îÄ PotHUDWidget.cs (modificato)
```

## üß™ **Testing & Debug Implementati**

### **Debug Tools**
- **Hotkeys**: F1 (sistema), F2 (selezione), F3 (azioni)
- **Context Menu**: "Recreate Pots", "Setup Layers", "Test Layer Configuration"
- **Logging**: debug dettagliato per ogni operazione
- **Gizmos**: visualizzazione in Editor per raggio interazione

### **Test Scenarios**
- **Setup iniziale**: 4 azioni, 3 semi, 0 CRY
- **Interazione vaso**: selezione, evidenziazione, azioni disponibili
- **UI click-through**: pulsanti non fanno muovere Player
- **Resource consumption**: azioni e CRY vengono consumati correttamente

##    **Limitazioni Note**

### **Non Implementato (per BLK-01.04+)**
- **Crescita piante**: sistema di crescita temporale
- **Variet√† semi**: solo seme generico `SDE-001`
- **Effetti visivi**: animazioni piantagione/crescita
- **Persistenza**: salvataggio stato vasi

### **Dipendenze Esterne**
- **HUD principale**: deve avere `PotHUDWidget` integrato
- **Canvas setup**: richiede `GraphicRaycaster` e `EventSystem`
- **Layer configuration**: richiede setup manuale o `LayerAutoSetup`

## üîÆ **Prossimi Task (BLK-01.03+)**

### **BLK-01.03 - Sistema di crescita piante**
- Estendere `PotStateModel` con stati di crescita
- Implementare logica temporale per sviluppo piante
- Aggiungere feedback visivo per stadi di crescita

### **BLK-01.04 - Variet√† piante e semi**
- Sistema di cataloghi semi con propriet√† diverse
- Effetti specifici per tipo di pianta
- Sistema di raccolta e conservazione

### **BLK-01.05 - Persistenza e progressione**
- Salvataggio stato vasi e piante
- Sistema di giorni e cicli di crescita
- Achievement e progressione giocatore

## üìä **Metriche di Completamento**
- **Core System**: 100% ‚úÖ
- **UI Integration**: 100% ‚úÖ  
- **Resource Management**: 100% ‚úÖ
- **Input Handling**: 100% ‚úÖ
- **Debug Tools**: 100% ‚úÖ
- **Documentation**: 100% ‚úÖ

**BLK-01.02 √® COMPLETAMENTE IMPLEMENTATO e pronto per il testing finale.** üéØ

---

*Report generato per riferimento futuro - Task completato con successo*

-----------------------------------------------------------------------------------

#    **REPORT DEV - BLK-01.03A Growth Core Bugfix**

## üéØ **SCOPO DEL TASK**
Implementare il sistema di crescita end-of-day per le piante nei vasi, con 3 stadi (Seed ‚Üí Sprout ‚Üí Mature) e calcolo punti basato su cura giornaliera.

## üö® **PROBLEMA IDENTIFICATO**
Le piante rimangono sempre a **Stadio 0** (Seed) nonostante cura ideale (Water + Light) per 12+ giorni consecutivi.

## üîç **DIAGNOSI COMPLETA APPLICATA**

### **1) Analisi Log Sistema (COMPLETATA)**
- ‚úÖ **LOG DI PLAY** ‚Üí Inizializzazione corretta (4 Azioni, 250 CRY)
- ‚úÖ **LOG CLICCA POT** ‚Üí Selezione e UI funzionanti
- ‚úÖ **LOG PLANT/WATER/LIGHT** ‚Üí Azioni eseguite correttamente
- ‚úÖ **LOG END DAY** ‚Üí Sistema crescita attivato

### **2) Identificazione Punto di Rottura (COMPLETATA)**
**Problema:** I flag giornalieri (`HydrationConsumedToday`, `LightExposureToday`) vengono resettati **PRIMA** del calcolo punti crescita.

**Log di Evidenza:**
```
[ACT-002][POT-001] Water OK: hydration=2/3, flag giornaliero impostato  ‚Üê Flag TRUE
[BLK-01.03A] : Punti calcolati: 0 (H=False, L=False)                   ‚Üê Flag FALSE durante End Day
```

##   Ô∏è **FIX APPLICATI (NON FUNZIONANTI)**

### **Fix A: PotGrowthController.cs - Ordine Operazioni**
- **Prima:** Calcolo punti ‚Üí Decay/Reset ‚Üí Flag resettati
- **Dopo:** Calcolo punti ‚Üí Aggiornamento stadi ‚Üí Decay/Reset
- **Risultato:** ‚ùå Non risolve il problema

### **Fix B: PlantGrowthConfig.asset - Reset Automatico**
- **Prima:** `resetDailyExposureFlags: 1` (True)
- **Dopo:** `resetDailyExposureFlags: 0` (False)
- **Risultato:** ‚ùå Non risolve il problema

### **Fix C: PotGrowthController.cs - DecayAndReset**
- **Prima:** Reset automatico flag giornalieri
- **Dopo:** Solo decay idratazione/luce, NO reset flag
- **Risultato:** ‚ùå Non risolve il problema

### **Fix D: PotStateModel.cs - Costruttori e Metodi**
- **Rimossi:** Reset flag da 4 metodi (Reset, PlantSeed, ResetToEmpty, costruttori)
- **Risultato:** ‚ùå Non risolve il problema

### **Fix E: PotGrowthController.cs - OnPlanted**
- **Rimosso:** Reset flag da OnPlanted()
- **Risultato:** ‚ùå Non risolve il problema

##    **CAUSA RADICE NON IDENTIFICATA**

Nonostante la rimozione di **TUTTI** i reset automatici dei flag giornalieri da:
- `PotGrowthController.cs` (2 posti)
- `PotStateModel.cs` (4 posti)
- `PlantGrowthConfig.asset` (1 posto)

**I flag giornalieri continuano a essere False durante End Day.**

## üìä **STATO ATTUALE**

### **‚úÖ COSA FUNZIONA:**
- Inizializzazione sistema crescita
- Registrazione vasi nel PlantGrowthSystem
- Trigger End Day ‚Üí OnDayChanged
- Applicazione crescita giornaliera
- Debug logs attivi

### **‚ùå COSA NON FUNZIONA:**
- Calcolo punti crescita (sempre 0)
- Avanzamento stadi (sempre Stadio 0)
- Persistenza flag giornalieri

## üéØ **PUNTI DI RIPARTENZA DOMANI**

### **1) Caccia al Reset Nascosto**
Cercare **ALTRI** posti dove i flag giornalieri vengono resettati:
- Altri script che modificano `PotStateModel`
- Eventi che resettano lo stato
- Serializzazione/deserializzazione

### **2) Debug Avanzato**
Aggiungere log per tracciare **QUANDO** e **DOVE** i flag vengono resettati:
- Log prima/dopo ogni modifica ai flag
- Stack trace per identificare chiamante
- Verifica stato flag durante tutto il ciclo End Day

### **3) Test Isolato**
Creare test minimo per verificare:
- Se i flag persistono senza End Day
- Se i flag si resettano durante End Day
- Se il problema √® nel calcolo o nella persistenza

## üìù **FILE MODIFICATI**

1. **`PotGrowthController.cs`** ‚Üí Fix ordine operazioni + rimozione reset flag
2. **`PotStateModel.cs`** ‚Üí Rimozione reset flag da tutti i metodi
3. **`PlantGrowthConfig.asset`** ‚Üí Disabilitato reset automatico

## üö´ **APPROCCIO FALLITO**

Tentativo di rimozione sistematica di tutti i reset automatici dei flag giornalieri non ha risolto il problema. **Serve approccio diverso.**

##    **PROSSIMI PASSI SUGGERITI**

1. **Analisi profonda** di tutti i posti dove `PotStateModel` viene modificato
2. **Debug avanzato** con tracciamento completo dei flag
3. **Test isolato** del sistema crescita
4. **Possibile refactoring** dell'architettura flag giornalieri

---

**Data:** [Data odierna]  
**Stato:** ‚ùå **NON RISOLTO** - Richiede nuovo approccio  
**Tempo Speso:** [Stima ore]  
**Prossima Sessione:** Nuova strategia di debug e analisi